<div class="page page-profile" ng-controller="ComposeCtrl">
	<section class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">
				Stuur nieuwe uitnodigingen
			</h3>
		</div>
		
		<div class="panel-body">
			<div class="compose-steps-box">
				<div class="row">
					<div class="col-lg-3 col-md-4 col-xs-12">
						<span ng-class="{active: (step == 0), future: (step < 0), past: (step > 0)}" class="btn btn-round btn-primary btn-lg btn-block btn-invoice-label">1. <span>Upload patiëntenbestard</span></span>
					</div>
					
					<div class="col-lg-3 col-md-4 col-xs-12">
						<span ng-class="{active: (step == 1), future: (step < 1), past: (step > 1)}" class="btn btn-round btn-primary btn-lg btn-block btn-invoice-label">2. <span>Controleer verzendlijst</span></span>
					</div>
					
					<div class="col-lg-3 col-md-4 col-xs-12">
						<span ng-class="{active: (step == 2), future: (step < 2), past: (step > 2)}" class="btn btn-round btn-primary btn-lg btn-block btn-invoice-label">3. <span>Stuur uitnodigingen</span></span>
					</div>
				</div>
			</div>
			
			<div class="well well-white">
				<div class="compose-steps-item" ng-show="step == 0">
					<form class="form-horizontal" enctype="multipart/form-data">
						<div class="drag-area btn-upload text-center">
							<div class="inner-upload-box" ng-show="status == 0">
								<i class="fa fa-cloud-upload"></i><br />
								Sleep een patiëntenbestand hiernaartoe
								<span class="drag-span">We ondersteunen .xls en .xlsx Excel-bestanden</span>
							</div>
							
							<div class="inner-upload-box" ng-show="status > 0">
								<div class="top-upload-box">
								</div>
								
								<div class="progress progress-bar-default">
									<div class="progress-bar" ng-class="{'progress-bar-success': status == 2, 'progress-bar-danger': status == 3}" role="progressbar" aria-valuenow="{{xlsFile.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{xlsFile.progress}}%;">
										<i class="fa fa-check"></i>
										<i class="fa fa-times"></i>
									</div>
								</div>
								
								<div ng-show="status == 1">
									<div class="too_long" ng-class="{'fade-out': too_long_time}">{{too_long_text}}</div>
									<span class="drag-span">Een ogenblik geduld...</span>
								</div>
								
								<div ng-show="status == 2">
									Het verwerken van uw patiëntenbestand is gelukt.
									<span class="drag-span">U kunt nu doorgaan naar de volgende stap.</span>
								</div>
								
								<div ng-show="status == 3">
									Het verwerken van uw patiëntenbestand is mislukt.
									<span class="drag-span">Wellicht heeft u een onjuist bestandsformaat geüpload. <a href="javascript:void(0);" ng-click="help()">Heeft u hulp nodig?</a></span>
								</div>
							</div>
							
							<input type="file" ng-show="status == 0" ngf-select ng-model="xlsFile" ng-change="uploadFile(xlsFile)" name="file" required ngf-model-invalid="errorFile" />
						</div>

						<div class="mail-actions">
							<span type="button" class="btn btn-primary btn-upload" ng-disabled="status == 1">
								<span>Kies bestand...</span>
								<input type="file" ngf-select ng-model="xlsFile" ng-change="uploadFile(xlsFile)" name="file" required ngf-model-invalid="errorFile" />
							</span>
							&nbsp;
							<a href="/excel-tpl" class="btn btn-default" ng-disabled="status == 1">Download sjabloon <i class="fa fa-file-o"></i></a>
						</div>
					</form>
				</div>
				
				<div class="compose-steps-item" ng-show="step == 1">
					<div class="alert alert-success" ng-if="check">
						<p>De verzendlijst is gecontroleerd en er zijn geen problemen gevonden.</p>
					</div>
					
					<div class="alert alert-warning" ng-if=" ! check">
						<p>Er zijn onderdelen met waarschuwingen gevonden. <a href="javascript:void(0);" ng-click="show_warnings()">{{ ! warnings ? 'Toon onderdelen' : 'Verberg onderdelen' }}</a></p>
					</div>
					
					<div class="table-responsive">
						<table class="table table-striped table-bordered">
							<thead>
								<tr>
									<th>Controle</th>
									<th ng-repeat="key in keys">
										{{headers[key]}}
									</th>
								</tr>
								
								<tr>
									<td>&nbsp;</td>
									<td ng-repeat="key in keys">
										<select class="form-control" ng-model="column[key]" ng-change="save_col(key)" ng-class="{'border-red': column[key] == 0 && ! dont_use[key]}">
											<option value="0" ng-selected="column[key] == 0 || dont_use[key]">{{dont_use[key] ? 'Niet gebruiken' : 'Kies een kolom'}}</option>
											<option value="{{c}}" ng-repeat="c in cols" ng-selected="column[key] == c && ! dont_use[key]">{{c}}</option>
										</select>
									</td>
								</tr>
							</thead>
							
							<tbody>
								<tr ng-repeat="d in page_data" ng-show="d.error == 0 || (d.error > 0 && warnings)">
									<td>
										<span class="btn btn-sm btn-success" ng-if="d.error == 0">In orde</span>
										<span class="btn btn-sm btn-warning" ng-if="d.error == 1">Dubbel</span>
										<span class="btn btn-sm btn-danger" ng-if="d.error == 2">Mist gegevens</span>
									</td>
									<td ng-repeat="key in keys" ng-bind-html="d[key]">
										{{d[key]}}
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					
					<nav class="uploads-nav" ng-if="pages > 1">
						<ul class="pagination">
							<li ng-class="{'disabled': page == 1}">
								<a href="javascript:void(0);" aria-label="Previous" ng-click="change_page(page - 1)">
									<span aria-hidden="true">&laquo;</span>
								</a>
							</li>
							<li ng-class="{'active': page == i}" ng-repeat="i in get_array(pages)">
								<a href="javascript:void(0);" ng-click="change_page(i)">{{i}}</a>
							</li>
							<li ng-class="{'disabled': page == pages}">
								<a href="javascript:void(0);" aria-label="Next" ng-click="change_page(page + 1)">
									<span aria-hidden="true">&raquo;</span>
								</a>
							</li>
						</ul>
					</nav>
				</div>
				
				<div class="compose-steps-item" ng-show="step == 2">
					<div class="compose-finish">
						<img src="/application/views/images/compose.svg" alt="" class="compose-icon" />
						U staat op het punt om {{send_emails.length}} patiënten een uitnodiging te sturen.
						<div class="compose-buttons">
							<button class="btn btn-danger" ng-click="send()" ng-disabled=" ! send_emails.length">Stuur uitnodigingen</button><br />
							<button class="btn btn-sm btn-default" ng-click="compose_prev()">Annuleer</button>
						</div>
					</div>
				</div>
			</div>
			
			<div class="row" ng-id="step < 2">
				<div class="col-sm-5 col-xs-12">
					<a href="javascript:void(0);" class="link-upload-help" ng-show="status > 1" ng-click="help()">Heeft u hulp nodig?</a><br /><br />
				</div>
				
				<div class="col-sm-7 col-xs-12 text-right">
					<button class="btn btn-primary compose-prev" ng-disabled="step == 0" ng-click="compose_prev()">Vorige</button>
					&nbsp;
					<button class="btn btn-primary compose-next" ng-disabled="status != 2" ng-click="compose_next()">Volgende</button>
				</div>
			</div>
		</div>
	</section>

	<script type="text/ng-template" id="help_upload.html">
		<div class="modal-header">
			<h3>
				Hulp bij het uploaden van uw patiëntenbestand
			</h3>
		</div>
		<div class="modal-body">
			<p>
				Als u problemen ervaart met het uploaden van uw patiëntenbestand kunt u onze Support-afdeling opdracht geven om het patiëntenbestand voor u te versturen.
			</p>
			
			<p>
				Wanneer u dit wenst, zullen wij uw patiëntenbestand controleren en voor u versturen. U ontvangt hiervan binnen één werkdag per e-mail een bevestiging.
			</p>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" ng-click="confirm()">Geef toestemming</button>
			<button class="btn btn-default" ng-click="cancel()">Annuleer</button>
		</div>
	</script>
</div>